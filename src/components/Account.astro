---
import "../styles/global.css";
import "../styles/account.css";
import { Image } from "astro:assets";
import avatarIcon from "../images/icons/default-avatar-icon.jpg";
import PopUpContainer from "./PopUpContainer.astro";
import "../styles/popUpContainer.css";
import "../styles/catalog.css";
import { cars } from "../data/cars.js";
import ProductCard from "./ProductCard.astro";
const {
    name,
    lastName,
    balance,
    dateOfBirth,
    email,
    phoneNumber,
    dateCreated,
} = Astro.props;
---

<div class="account-container">
    <div class="sub-header">
        <h1>Hello, {name}</h1>
        <div class="balance-sign-out-div">
            <h2>Your balance: {balance}</h2>
            <button>Sign out</button>
        </div>
    </div>

    <div class="account">
        <div class="profile-sidebar">
            <div class="avatar-section">
                <Image src={avatarIcon} alt="avatar" class="avatar-img" />
                <span class="avatar-label">{name} {lastName}</span>
                <span class="avatar-label">{email}</span>
                <span class="avatar-label"></span>
                <button class="change-avatar-button">Change avatar icon</button>
            </div>
            <div class="nav-options">
                <button class="option-button">Personal information</button>
                <button class="option-button">Wish list</button>
            </div>
        </div>
        <div class="personal-info-section">
            <div class="option-section option-section-active">
                <div class="personal-info-header">
                    <h3>Personal info</h3>
                    <button class="edit-info-button">Edit info</button>
                </div>
                
                <div class="personal-info-container">
                    <div class="personal-info">
                        <h4>Name</h4>
                        <span class="info-cell">{name}</span>
                    </div>
                    <div class="personal-info">
                        <h4>Last Name</h4>
                        <span class="info-cell">{lastName}</span>
                    </div>
                    <div class="personal-info">
                        <h4>Email address</h4>
                        <span class="info-cell">{email}</span>
                    </div>
                    <div class="personal-info">
                        <h4>Phone number</h4>
                        <span class="info-cell">{phoneNumber}</span>
                    </div>
                    <div class="personal-info">
                        <h4>Date of birth</h4>
                        <span class="info-cell">{dateOfBirth}</span>
                    </div>
                    
                    <div class="personal-info">
                        <h4>Date created</h4>
                        <span class="info-cell"></span>{dateCreated}
                    </div>
                </div>
            </div>
            <div class="option-section">
                <div class="catalog">
                    {
                        cars.map((car) => (
                        <ProductCard {...car}/>
                    ))
                    }
                </div>
            </div>
        </div>
    </div>
    
</div>

<PopUpContainer>
    <h2 class="form-heading">Edit personal information</h2>
    <div class="form-items">
        <div class="form-item-name-fields">
            <label class="item-label" for="first-name">First Name</label>
            <label class="item-label" for="last-name">Last Name</label>
            <input
                class="pop-up-input"
                type="text"
                placeholder="Enter Name"
                name="first-name"
            />
            
            <input
                class="pop-up-input"
                type="text"
                placeholder="Enter Last name"
                name="last-name"
            />
        </div>
        <div class="form-item">
            <label class="item-label" for="email">Email</label>
            <input
                class="pop-up-input"
                type="text"
                placeholder="Enter Email"
                name="email"
            />
        </div>
        <div class="form-item">
            <label class="item-label" for="phone-number">Phone Number</label>
            <input
                class="pop-up-input"
                type="text"
                placeholder="Enter Email"
                name="phone-number"
            />
        </div>
        <div class="form-item">
            <label class="item-label" for="birth-date">Date of Birth</label>
            <input
                class="pop-up-input"
                type="text"
                placeholder="Enter date of birth"
                name="birth-date"
            />
        </div>
    </div>
    <div class="submit-button">
        <button class="submit-button">Save Changes</button>
    </div>
</PopUpContainer>

{
    /* <!-- <div class="personal-info-pop-up">
    <form action="" class="personal-info-form">
                <div class="pop-up-button">
            <button class="submit-button">Save Changes</button> 
        </div>
    </form>
    
</div> --> */
}

<script>
    import { accounts } from "../data/accounts";

    

    const edit_info_button = document.querySelector(".edit-info-button");
    const pop_up = document.querySelector(".pop-up-container");
    const pop_up_inputs = document.querySelectorAll(".pop-up-input");
    const option_buttons = document.querySelectorAll(".option-button");
    const option_sections = document.querySelectorAll(".option-section");
    edit_info_button?.addEventListener("click", () => {
        pop_up?.classList.add("active");
    });
    const submit_button = document.querySelector(".submit-button");
    submit_button?.addEventListener("click", () => {
        const input_values: string[] = [];
        pop_up_inputs.forEach((pop_up_input) => {
            const inputElement = pop_up_input as HTMLInputElement;
            input_values.push(inputElement.value);
        });
        const fields = [
            "name",
            "lastName",
            "dateOfBirth",
            "email",
            "phoneNumber",
            
        ];
        console.log(input_values);
        fields.forEach((key, i) => {
            (accounts as any)[key] = input_values[i];
        });
        document.querySelectorAll(".info-cell").forEach((cell, i) => {
        const key = fields[i];
            (accounts as any)[key] != "" ?(cell as HTMLElement).textContent = (accounts as any)[key] : "";
        });
        
        // const nameSpan = document.querySelector(".sub-header h1");
        // const avatarLabel1 = document.querySelectorAll(".avatar-label")[0]; // name + lastName
        // const avatarLabel2 = document.querySelectorAll(".avatar-label")[1]; // email

        // if (nameSpan) nameSpan.textContent = `Hello, ${accounts[0].name}`;
        // if (avatarLabel1) avatarLabel1.textContent = `${accounts[0].name} ${accounts[0].lastName}`;
        // if (avatarLabel2) avatarLabel2.textContent = accounts[0].email;
        pop_up?.classList.remove("active");
    });

    option_buttons.forEach((option_button, index) =>{
        option_button.addEventListener("click",() =>{
            console.log("button clicked")
            option_sections.forEach(option_section => option_section.classList.remove("option-section-active"));
            option_sections[index].classList.add("option-section-active")
        })
    })
</script>
